<div class="row notifications">
  <% puts broker_application.inspect %>
  <% if broker_application['data']['keep_deployments'].to_i > 1 %>
    <div class="alert alert-warning">
      Your application configuration enables just one deployments at the time. You can increase the number
      of deployments to keep by using: <code>$ rhc configure-app --keep-deployments 10 --app <%=ENV['OPENSHIFT_APP_NAME']%></code>.
    </div>
  <% end %>
</div>
<div class="row">
  <div class="col-sm-12">
    <div class="list-group">
      <% deployments.each do |timestamp, data| %>
        <% data.merge!(commit(data['git_sha1'])) %>
        <div class="list-group-item clearfix">
          <span class="pull-left gravatar">
            <img src="http://www.gravatar.com/avatar.php?gravatar_id=<%=data['author_digest']%>" height="36"/>
          </span>
          <span class="btn-group pull-right">
            <button type="button" class="btn btn-default dropdown-toggle commit-btn" data-toggle="dropdown">
              <code><%=h data['git_sha1']%></code> <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Activate</a></li>
              <li><a href="#">Show code</a></li>
              <li class="divider"></li>
              <li><a href="#">Remove</a></li>
            </ul>
          </span>
          <h4 class="list-group-item-heading">
            <%=h data['message']%>
          </h4>
          <p class="list-group-item-text commit-author">
            <span class="author"><%=h data['author']%></span> pushed this deployment <%=timestamp%>
          </p>
        </div>
      <% end %>
    </div>
  </div>
</div>
